# 現状
- スクレイピング処理
  - GHAの定期実行でAWSのS3への定期転送実装済。
  - リポジトリのクリーンUpが残

- static siteサービス処理
  - CDKを使った自動デプロイ、デプロイ後のチェックまで済。
  - GHAからの転送は非対応

- クライアントサイド処理
  - ほとんど手つかず。
  - 現状、原始的なスクリプトによる動的な目次生成をstaticファイルとしてstatic siteサービス処理のリポジトリに置いてある。
  
# 構想
## 構成概要
- スクレイピング処理
  - GitHub actionsで定期実行、実行後AWSのS3に転送。
  - 実装済。安定運用している。
  - 最終的にはprd環境のS3に転送する。

- static siteサービス処理
  - このリポジトリ。
  - スクレイピング処理の結果が定期的にS3に入る。
  - 一定期間経過後はGracierに移行
  - 現在有効なデータは、スクレイピング処理のGHAからの転送をトリガとしてlambdaで更新、CloudFrontのキャッシュ無効化を実施
  - 開発要素は少なめ。

- クライアントサイド処理
  - reactベースのクライアントサイドレンダリング処理。
  - クライアントサイド処理のデプロイでは、GHAでstatic siteサービス処理のasset下にコピー&Lambdaでキャッシュ無効化。
  - S3にある有効なデータ情報を取得し、統一的なディレクトリ構造に基づき表示を行う。
    - 表示以外の付加価値をつける。
      - 読み上げ
      - 画像へのユーザー書き込み/保存

## 開発/運用環境
- 環境は3環境準備
  - dev(開発用)
    - 作って壊しを繰り返す。
    - アクセス制限等はゆるめでもOK
    - スクレイピング処理結果は、自動転送先にしない。
      - 開発用テストデータを使うorテスト環境からデータを転送させる。
  - stg(ステージング)
    - prdに持っていく前の動作確認/アクセス確認用
    - アクセス制限は厳し目にする。
    - ここで確認したものと同じものでprdに持っていく。
    - アカウントはdevと同じでもいい。
  - prd(本番)
    - 公開用
    - アカウントはdevと分ける。
    - スクレイピング処理結果の転送先はここ。

- 差分整理必要なアイテム
  - スクレイピング処理結果転送
  - アクセス制限

# 気になる点
- my-static-siteという名称いまいち
- site-contentの下にクライアントサイドのコード入れるか?別レポ?
  - 同じにするメリットがあまりない。
  - GHAからの転送&CachInvalidateで行けそう
- スクレイピング処理は別レポがよい?
  - GHAでの動作を考えると小さいほうがよい?
- stg用、prd用はCD/CI化したい。
- upload_done.flag は、参照したら消す?ファイル名は変わるかも。
- デプロイ後の動作確認2回目でないとPASSしない
- S3バケット、バージョンありになってる。なしでもよくないか?


---
